!function(a){DONATE_Site={$doc:null,init:function(){this.$doc=a(document),this.validate_checkout_form(),this.generate_percent(),this.$doc.on("click",".donate_payments li a",this.payment_gateway_tab),this.$doc.on("click",".donate_load_form, .donate_button_title",this.load_donate_form),this.$doc.on("submit",".donate_form",this.donate_submit),this.hooks.init()},hooks:{init:function(){TP_Donate_Global.addAction("donate_submit_submited_form_completed",this.submited)},submited:function(b){"success"===b.status&&void 0!==b.url?window.location.href=b.url:"failed"===b.status&&void 0!==b.message&&(console.log(b.message),DONATE_Site.generate_messages(b.message),console.log(DONATE_Site.generate_messages(b.message)),a("body, html").animate({scrollTop:a(".donation-messages").offset().top}))}},payment_gateway_tab:function(b){b.preventDefault();var c=a(this),d=c.parents("li:first"),e=c.attr("data-payment-id"),f=a('input[name="payment_method"]'),g=c.attr("href"),h=a(".payment-method");return!d.hasClass("active")&&(f.val(e),c.parents(".donate_payments:first").find("li").removeClass("active"),d.addClass("active"),h.slideUp(400,function(){a(g).slideDown()}),!1)},load_donate_form:function(b){b.preventDefault();var c=a(this),d=c.attr("data-campaign-id"),e={action:"donate_load_form",nonce:thimpress_donate.nonce};void 0!==d&&(e.campaign_id=d),a.ajax({url:thimpress_donate.ajaxurl,type:"POST",data:e,dataType:"html",beforeSend:function(){TP_Donate_Global.beforeAjax()}}).done(function(b){TP_Donate_Global.afterAjax(),a("#donate_hidden").html(b),a.magnificPopup.open({type:"inline",items:{src:"#donate_hidden"},callbacks:{open:function(){var b=setTimeout(function(){a('#donate_hidden input[name="donate_input_amount"]:first').focus(),a('#donate_hidden input[name="payment_method"]:first').attr("checked",!0),TP_Donate_Global.applyFilters("donate_loaded_donate_form",e),clearTimeout(b)},100)}}})})},validate_checkout_form:function(){for(var b=a(".donate_form"),c=b.find("input, textarea"),d=0;d<c.length;d++){a(c[d]).blur(function(){var b=a(this);b.hasClass("required")&&(""===b.val()||b.hasClass("email")&&!1===new RegExp("^[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&'*+\\/0-9=?A-Z^_`a-z{|}~]+.[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+$").test(b.val())?b.removeClass("validated").addClass("donate_input_invalid").addClass("error"):b.removeClass("donate_input_invalid").removeClass("error").addClass("validated"))})}},donate_submit:function(b){b.preventDefault();var c=a(this);c.find(".donate_form_layout"),c.find(".donation-messages");c.find(".donate_form_error_messages").remove();var f=c.serializeArray(c);if(TP_Donate_Global.applyFilters("donate_before_submit_form",f))return a.ajax({url:thimpress_donate.ajaxurl,type:"POST",data:f,beforeSend:function(){TP_Donate_Global.processing()}}).done(function(b){if(TP_Donate_Global.complete(),b=TP_Donate_Global.applyFilters("donate_submit_submited_form_results",b),void 0!==b.status&&(b&&TP_Donate_Global.doAction("donate_submit_submited_form_completed",b),void 0!==b.form&&void 0!==b.args&&!0===b.form)){var d=b.args;if(0!==Object.keys(d).length){var e=[];e.push('<form id="donate_form_instead" action="'+b.url+'" method="POST">'),a.each(d,function(a,b){e.push('<input type="hidden" name="'+a+'" value="'+b+'" />')}),e.push('<button type="submit" class="donate-redirecting">'+b.submit_text+"</button>"),e.push("</form>"),c.replaceWith(e.join("")),a("#donate_form_instead").submit()}}}),!1},donate_on_lightbox:function(){return void 0!==thimpress_donate.settings&&void 0!==thimpress_donate.settings.checkout&&void 0!==thimpress_donate.settings.checkout.lightbox_checkout&&"yes"===thimpress_donate.settings.checkout.lightbox_checkout},generate_messages:function(b){var c=a(".donate_form");1===c.find(".donation-messages").length?a(".donation-messages").replaceWith(b):c.prepend(b)},beforeAjax:function(a){void 0!==a&&a.find(".donate_button").addClass("donate_button_processing")},afterAjax:function(a){void 0!==a&&a.find(".donate_button").removeClass("donate_button_processing")},generate_percent:function(){for(var b=a(".donate_counter_percent"),c=0;c<b.length;c++){var d=a(b[c]),e=d.attr("data-percent"),f=d.parent(".donate_counter:first"),g=f.outerWidth(),h=d.find(".donate_percent_tooltip"),i=h.outerWidth();d.css({width:e+"%"}),i/2>=d.outerWidth()?h.css({left:0}):i/2+d.outerWidth()<=g?h.css({left:d.outerWidth()-i/2}):i/2+d.outerWidth()>g&&h.css({left:g-i})}}},a(document).ready(function(){DONATE_Site.init()}),a(window).resize(function(){DONATE_Site.generate_percent()})}(jQuery);